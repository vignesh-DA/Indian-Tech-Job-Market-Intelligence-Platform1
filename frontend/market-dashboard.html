<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Dashboard - Tech Job Intelligence</title>
    <link rel="stylesheet" href="/assets/css/variables.css">
    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <link rel="stylesheet" href="/assets/css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <i class="fas fa-briefcase"></i>
                <span>Tech Job Intelligence</span>
            </div>
            
            <div class="navbar-right">
                <ul class="navbar-menu">
                    <li><a href="/" class="nav-link">Home</a></li>
                    <li><a href="/recommendations" class="nav-link">Recommendations</a></li>
                    <li><a href="/dashboard" class="nav-link active">Dashboard</a></li>
                    <li><a href="/saved-jobs" class="nav-link">Saved Jobs</a></li>
                </ul>
                
                <!-- Profile Icon -->
                <div class="nav-profile-item">
                    <div class="profile-wrapper" id="profileBtn" title="Profile">
                        <i id="profileImg" class="fas fa-user-circle" style="font-size: 32px; color: #3b82f6; cursor: pointer;"></i>
                    </div>
                    
                    <!-- Dropdown Menu -->
                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="dropdown-header">
                            <i id="dropdownProfilePic" class="fas fa-user-circle" style="font-size: 40px; color: #3b82f6;"></i>
                            <div class="dropdown-user-info">
                                <div class="dropdown-user-name" id="dropdownUserName">User</div>
                                <div class="dropdown-user-email" id="dropdownUserEmail">user@example.com</div>
                            </div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="#" class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </a>
                    </div>
                </div>
                
                <div class="navbar-toggle" id="navToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container" style="padding-top: var(--spacing-2xl); padding-bottom: var(--spacing-2xl);">
            <h1 style="margin-bottom: var(--spacing-lg);">ðŸ“Š Market Dashboard</h1>
            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-2xl);">
                Real-time insights into the Indian tech job market trends, opportunities, and salary data.
            </p>

            <!-- Summary Metrics -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-2xl);">
                <div class="card" style="padding: var(--spacing-lg); text-align: center;">
                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">Total Jobs</p>
                    <p id="totalJobsMetric" style="font-size: var(--text-3xl); font-weight: var(--font-bold); color: var(--primary-color);">-</p>
                </div>
                <div class="card" style="padding: var(--spacing-lg); text-align: center;">
                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">Companies Hiring</p>
                    <p id="companiesMetric" style="font-size: var(--text-3xl); font-weight: var(--font-bold); color: var(--secondary-color);">-</p>
                </div>
                <div class="card" style="padding: var(--spacing-lg); text-align: center;">
                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">Locations</p>
                    <p id="locationsMetric" style="font-size: var(--text-3xl); font-weight: var(--font-bold); color: var(--accent-color);">-</p>
                </div>
                <div class="card" style="padding: var(--spacing-lg); text-align: center;">
                    <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">Avg Salary</p>
                    <p id="avgSalaryMetric" style="font-size: var(--text-3xl); font-weight: var(--font-bold); color: var(--success-color);">-</p>
                </div>
            </div>

            <!-- Filters -->
            <div class="card" style="margin-bottom: var(--spacing-2xl);">
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing-md);">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label" style="margin-bottom: var(--spacing-sm);">Days</label>
                            <select id="daysFilter" class="form-select">
                                <option value="7">Last 7 days</option>
                                <option value="14">Last 14 days</option>
                                <option value="30" selected>Last 30 days</option>
                                <option value="90">Last 90 days</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label" style="margin-bottom: var(--spacing-sm);">Location</label>
                            <div style="position: relative;">
                                <select id="locationFilter" class="form-select">
                                    <option value="">All locations</option>
                                </select>
                                <i id="locationLoadingSpinner" class="fas fa-spinner fa-spin" style="position: absolute; right: 35px; top: 50%; transform: translateY(-50%); color: var(--primary-color); display: none;"></i>
                            </div>
                        </div>
                        <div style="display: flex; align-items: flex-end;">
                            <button class="btn btn-primary" id="refreshDashboard" style="width: 100%;">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Salary & Skills Analysis -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: var(--spacing-2xl); margin-bottom: var(--spacing-2xl);">
                <div class="card">
                    <div class="card-header">
                        <h3>ðŸ’° Salary Trends by Location</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="salaryTrendsChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>ðŸ”§ Top In-Demand Skills</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="skillsChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Companies & Locations Charts -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: var(--spacing-2xl); margin-bottom: var(--spacing-2xl);">
                <div class="card">
                    <div class="card-header">
                        <h3>Top Hiring Companies</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="companiesChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>Jobs by Location</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="locationsChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Trends & Distribution -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: var(--spacing-2xl); margin-bottom: var(--spacing-2xl);">
                <div class="card">
                    <div class="card-header">
                        <h3>ðŸ“… Job Posting Trends</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="trendsChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3>ðŸ‘¥ Experience Distribution</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="experienceChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Roles Distribution -->
            <div class="card" style="margin-bottom: var(--spacing-2xl);">
                <div class="card-header">
                    <h3>ðŸ’¼ Job Roles Distribution</h3>
                </div>
                <div class="card-body">
                    <canvas id="rolesChart" style="max-height: 400px;"></canvas>
                </div>
            </div>

            <!-- Salary Analytics -->
            <div class="card" style="margin-bottom: var(--spacing-2xl);">
                <div class="card-header">
                    <h3>Salary Analytics</h3>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-2xl);">
                        <div style="padding: var(--spacing-lg); background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: var(--radius-md);">
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">Minimum Salary</p>
                            <p id="minSalary" style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: var(--primary-color);">-</p>
                        </div>
                        <div style="padding: var(--spacing-lg); background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: var(--radius-md);">
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">Average Salary</p>
                            <p id="avgSalary" style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: var(--primary-color);">-</p>
                        </div>
                        <div style="padding: var(--spacing-lg); background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: var(--radius-md);">
                            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-sm);">Maximum Salary</p>
                            <p id="maxSalary" style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: var(--primary-color);">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Companies -->
            <div class="card" style="margin-bottom: var(--spacing-2xl);">
                <div class="card-header">
                    <h3>Top Companies Hiring</h3>
                </div>
                <div class="card-body">
                    <div id="topCompaniesContainer" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg);">
                        <div style="text-align: center; padding: var(--spacing-2xl);">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top Locations -->
            <div class="card" style="margin-bottom: var(--spacing-2xl);">
                <div class="card-header">
                    <h3>Top Job Locations</h3>
                </div>
                <div class="card-body">
                    <div id="topLocationsContainer">
                        <div style="text-align: center; padding: var(--spacing-2xl);">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Tech Job Intelligence</h4>
                    <p>Your AI-powered job search assistant for the Indian tech market, helping you understand why a job fits you â€“ not just showing listings.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/recommendations">Recommendations</a></li>
                        <li><a href="/dashboard">Dashboard</a></li>
                        <li><a href="/saved-jobs">Saved Jobs</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>About Tech Job Intelligence</h4>
                    <p style="margin-bottom: var(--spacing-md); color: var(--text-secondary);">Tech Job Intelligence helps you make smarter career decisions using AI-powered job matching, skill-gap analysis, and market insights.</p>
                    <ul style="list-style: disc; padding-left: 20px;">
                        <li>Personalized job recommendations</li>
                        <li>Explainable match scores</li>
                        <li>Skill improvement guidance</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Floating Chatbot Button & Widget -->
    <div id="chatbot-button" class="chatbot-button" title="Chat with AI Assistant">
        <i class="fas fa-comments"></i>
    </div>

    <div id="chatbot-widget" class="chatbot-widget">
        <!-- Chatbot Header -->
        <div class="chatbot-header">
            <div class="chatbot-title">
                <i class="fas fa-robot"></i>
                <span>Career Assistant</span>
            </div>
            <button id="chatbot-close" class="chatbot-close" title="Close chat">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Chatbot Messages Area -->
        <div id="chatbot-messages" class="chatbot-messages">
            <div class="chatbot-message bot-message">
                <div class="message-content">
                    <p>ðŸ‘‹ Hi! I'm your Career Assistant. I can help you with:</p>
                    <ul style="margin-top: 8px; margin-left: 16px; font-size: 13px;">
                        <li>ðŸ’¼ Understanding job opportunities</li>
                        <li>ðŸŽ¯ Planning your career path</li>
                        <li>ðŸ“š Building missing skills</li>
                        <li>ðŸ“Š Market insights & salary info</li>
                    </ul>
                    <p style="margin-top: 8px; font-size: 12px; opacity: 0.8;">What can I help you with?</p>
                </div>
                <div class="message-time">Just now</div>
            </div>
        </div>

        <!-- Chatbot Input Area -->
        <div class="chatbot-input-area">
            <input 
                type="text" 
                id="chatbot-input" 
                class="chatbot-input" 
                placeholder="Type your question..." 
                autocomplete="off"
            >
            <button id="chatbot-send" class="chatbot-send" title="Send message">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/assets/js/config.js"></script>
    <script src="/assets/js/api.js"></script>
    <script src="/assets/js/utils.js"></script>
    <script src="/assets/js/main.js"></script>
    <script src="/assets/js/profile.js"></script>
    <script src="/assets/js/dashboard.js"></script>
    <script src="/assets/js/chatbot.js"></script>
    
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication and load profile
            await checkAuth();
            
            // Setup profile dropdown and logout
            setupProfileDropdown();
            setupLogout();
        });
    </script>
</body>
</html>
